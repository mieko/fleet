foreground = yes
pid = /var/run/stunnel@redis.pid
fips = no
syslog = no

[redis]
; This is the non-deprecated way to say "verify 2"
; verifyChain = yes
; verifyPeer = yes
; requireCert = yes
verify = 2

cafile = /etc/ssl/metermd/metermd-ca.crt
cert = /etc/ssl/metermd/redis-server.pem
checkHost = redis-client

sslVersion = TLSv1.2
options = -NO_SSLv3

ciphers = EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH
options = CIPHER_SERVER_PREFERENCE

; accept lines generated from ips:
<% %w(ipv4_private ipv6_private).each do |key| %>
  <% if (addr = node.definition[key]) %>
    accept = <%= addr %>:6379
  <% end %>
<% end %>

; TODO: make this a Unix socket
connect = /var/run/redis/redis.sock
